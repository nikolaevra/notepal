<!DOCTYPE html>
<html>
<head>
</head>
<script src="https://code.jquery.com/jquery-3.2.1.js"
        integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
<script src="difflib.js"></script>
<body>

<p>This is the original text:</p>
<textarea id="a1" rows="10" cols="100" type="text">
</textarea>

<p id="title">This are the changes that you made:</p>
<textarea rows="10" cols="100" id="output" for="title"></textarea>

<script>

    $(document).ready(function() {
        let oldtext = 'Adult education is essential for Democracy of India. The number of grown up illiterates is great. All college and senior School students should come forward to visit villages in the summer vacation. Each one will teach one there. This will remove illiteracy and strengthen our democracy.';

        $("#a1").val(oldtext);

        $("#a1").change(function() {
            let changes = diffUsingJS(oldtext, $("#a1").val());
            let result = applyPatch(changes.base, changes.opcodes);

            console.log(result);
            $("#output").val(JSON.stringify(changes));
        });
    });

    function diffUsingJS(base, newtxt) {
        let sm = new difflib.SequenceMatcher(base, newtxt);
        let opcodes = sm.get_opcodes();


        for (let i = 0; i < opcodes.length; i++) {
            let substr = newtxt.substring(opcodes[i][3], opcodes[i][4]);
            opcodes[i] = {
                type: opcodes[i][0],
                val: substr,
                nstart: opcodes[i][3],
                nend: opcodes[i][4],
                ostart: opcodes[i][1],
                oend: opcodes[i][2],
            };
        }
        return {
            base: base,
            newtxt: newtxt,
            opcodes: opcodes,
        };
    }

    function applyPatch(old, patch) {
        let newtxt = old;

        for (let i = 0; i < patch.length; i++) {
            let front = '';
            let tail = '';

            if (patch[i].type === "insert") {
                front = newtxt.substring(0, patch[i].nstart);
                tail = newtxt.substring(patch[i].nstart, newtxt.length);
                newtxt = front + patch[i].val + tail;
            } else if (patch[i].type === "delete") {
                let len = patch[i].oend - patch[i].ostart;
                front = newtxt.substring(0, patch[i].nstart);
                tail = newtxt.substring(patch[i].nstart + len, newtxt.length);
                newtxt = front + "" + tail;
            } else if (patch[i].type === "replace") {
                let len = patch[i].oend - patch[i].ostart;
                front = newtxt.substring(0, patch[i].nstart);
                tail = newtxt.substring(patch[i].nstart + len, newtxt.length);
                newtxt = front + patch[i].val + tail;
            }
        }
        return newtxt;
    }
</script>
</body>
</html>
